<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>PetFeeder</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='MDB/css/bootstrap.min.css') }}">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" href="{{ url_for('static', filename='MDB/css/mdb.min.css') }}">
    <!-- My Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">


    <script type="text/javascript">
            function remove_time(rem_time){
                const request = new XMLHttpRequest();
                request.open('POST', '/remove-time');

                request.onload = () => {

                    //Remove contents of the messages
                    document.querySelector('#error-msg').innerHTML = '';

                    const data = JSON.parse(request.responseText);

                    if(data.success){
                       document.querySelector(`#time${rem_time}`).remove();
                    } else {
                       const content = `<div class="row justify-content-center alert alert-danger text-center">Error: Could not delete time.</div>`;
                       document.querySelector('#error-msg').innerHTML += content;
                    }
                };

                const data = new FormData();
                data.append('rem_time', rem_time);

                request.send(data);
                return false;
            }
    </script>
</head>
<body>

    <!-- Start your project here-->
  <div class="row justify-content-center text-center mt-4">
    <div class="col-lg-5 col-md-7 col-sm-6 col-xm-12">
      <h1 class="animated fadeIn mb-2">Pet Feeder</h1>
        <div class="text-center border border-light p-5">
            <!-- Flash messages -->
            {% with messages = get_flashed_messages() %}
              {% if messages %}
                {% for category, message in messages %}
                    <div class='alert alert-{{ category }} alert-dismissible m-1 p-1' role="alert">
                    <button type="button" class="close m-1 p-1" data-dismiss="alert">x</button>
                    {{ message }}
                    </div>
               {% endfor %}
              {% endif %}
            {% endwith %}
            <!-- Flash messages -->

            <!-- Feed now button -->
            <button class='btn btn-success btn-block' id="feednow"> Feed Now</button>

            <hr>
            <!-- Scheduled time list -->
            {% if schedule|length|int > 0 %}
                <p>Current scheduled times:</p>
            {% else %}
                <p class="h4 mb-4">Create Schedule</p>
            {% endif %}

            <div class="p-3 " id="sched-list">
                {% for t in schedule %}
                    <div class="row justify-content-center" id="time{{ t.time }}">
                         <div class="col-3 alert alert-primary text-center m-0 p-1 rounded-0">
                            <i class="fas fa-lg fa-stopwatch"></i>
                        </div>
                         <div class="col-7 alert alert-primary text-center font-weight-bold m-0 p-1 rounded-0">
                            {% if (t.time|int) < 12 and (t.time|int) > 0 %}
                                {{ t.time }}:00 am
                            {% elif (t.time|int) == 0 %}
                                12:00 am
                            {% elif (t.time|int) == 12 %}
                                12:00 pm
                            {% else %}
                                {{ (t.time)|int - 12 }}:00 pm
                            {% endif %}
                        </div>
                        <button class="col-2 btn btn-danger shadow-none text-center text-center m-0 p-1 rounded-0 border border-light" onclick="remove_time({{ t.time }})">
                            <i class="fas fa-lg fa-times"></i>
                        </button>
                    </div>
                {% endfor %}
            </div>

            <div id="error-msg"></div>

            <!-- Set interval form -->
            <form id='sched-form'>
                <label>Add a time:</label>
                <!-- Subject -->
                <select class="browser-default custom-select" id="add-to-sched">
                    <option value="disabled-option" disabled selected>Choose Time</option>
                    <option value="1">1 am</option>
                    <option value="2">2 am</option>
                    <option value="3">3 am</option>
                    <option value="4">4 am</option>
                    <option value="5">5 am</option>
                    <option value="6">6 am</option>
                    <option value="7">7 am</option>
                    <option value="8">8 am</option>
                    <option value="9">9 am</option>
                    <option value="10">10 am</option>
                    <option value="11">11 am</option>
                    <option value="12">12 pm</option>
                    <option value="13">1 pm</option>
                    <option value="14">2 pm</option>
                    <option value="15">3 pm</option>
                    <option value="16">4 pm</option>
                    <option value="17">5 pm</option>
                    <option value="18">6 pm</option>
                    <option value="19">7 pm</option>
                    <option value="20">8 pm</option>
                    <option value="21">9 pm</option>
                    <option value="22">10 pm</option>
                    <option value="23">11 pm</option>
                    <option value="0">12 am</option>
                </select>
                <input type="submit" class="btn btn-info btn-block mt-3 shadow-none" value="Add to schedule">
            </form>
            <!-- Set interval form-->
        </div>
    </div>
  </div>

    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="{{ url_for('static', filename='MDB/js/jquery-3.4.1.min.js') }}"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="{{ url_for('static', filename='MDB/js/popper.min.js') }}"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="{{ url_for('static', filename='MDB/js/bootstrap.min.js') }}"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="{{ url_for('static', filename='MDB/js/mdb.min.js') }}"></script>
    <!-- My js script -->
    <script type="text/javascript" src="{{ url_for('static', filename='scripts/index.js') }}"></script>
</body>
</html>